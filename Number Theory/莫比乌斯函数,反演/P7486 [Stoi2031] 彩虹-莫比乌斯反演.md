# P7486 [Stoi2031] 彩虹-莫比乌斯反演

## 题目

$$
给定n\in N^*,询问t组,每组1\leq l\leq r\leq n,求\prod_{i=l}^r\prod_{j=l}^r{lcm(i,j)^{lcm(i,j)}}\bmod 32465177
\\1\leq n\leq 10^6,1\leq t\leq 10
$$

## 分析

$$
\\\begin{align}
\\&不难想到用前缀积\prod_{i=1}^n\prod_{j=1}^m{lcm(i,j)^{lcm(i,j)}}来求区间[l,r]的答案
\\\prod_{i=l}^r\prod_{j=l}^r{lcm(i,j)^{lcm(i,j)}}&=\prod_{i=1}^r\frac{\prod_{j=1}^r{lcm(i,j)^{lcm(i,j)}}}{\prod_{j=1}^{l-1}{lcm(i,j)^{lcm(i,j)}}}
\\&=\frac{\prod_{i=l}^r\prod_{j=1}^r{lcm(i,j)^{lcm(i,j)}}}{\prod_{i=l}^r\prod_{j=1}^{l-1}{lcm(i,j)^{lcm(i,j)}}}
\\&=\frac{\frac{\prod_{i=1}^r\prod_{j=1}^r{lcm(i,j)^{lcm(i,j)}}}{\prod_{i=1}^{l-1}\prod_{j=1}^r{lcm(i,j)^{lcm(i,j)}}}}{\frac{\prod_{i=1}^r\prod_{j=1}^{l-1}{lcm(i,j)^{lcm(i,j)}}}{\prod_{i=1}^{l-1}\prod_{j=1}^{l-1}{lcm(i,j)^{lcm(i,j)}}}}
\\&=\frac{\prod_{i=1}^r\prod_{j=1}^r{lcm(i,j)^{lcm(i,j)}*\prod_{i=1}^{l-1}\prod_{j=1}^{l-1}{lcm(i,j)^{lcm(i,j)}}}}{\big[\prod_{i=1}^{l-1}\prod_{j=1}^r{lcm(i,j)^{lcm(i,j)}}\big]^2}
\\&下面来计算\prod_{i=1}^n\prod_{j=1}^m{lcm(i,j)^{lcm(i,j)}}:
\\\prod_{i=1}^n\prod_{j=1}^m{lcm(i,j)^{lcm(i,j)}}&=\Big(\frac{i*j}{gcd(i,j)}\Big)^{\frac{i*j}{gcd(i,j)}}
\\&=\prod_{i=1}^n\prod_{j=1}^m\prod_{d=1}^{min(n,m)}\Big(\frac{i*j}{d}\Big)^{\frac{i*j}{d}*[gcd(i,j)=d]}
\\&=\prod_{d=1}^{min(n,m)}\prod_{i=1}^n\prod_{j=1}^m\Big(d*\frac{i}{d}*\frac{j}{d}\Big)^{d*\frac{i}{d}*\frac{j}{d}*[gcd(\frac{i}{d},\frac{j}{d})=1]}
\\&=\prod_{d=1}^{min(n,m)}\prod_{i=1}^{\lfloor\frac{n}{d}\rfloor}\prod_{j=1}^{\lfloor\frac{m}{d}\rfloor}\Big(d*i*j\Big)^{d*i*j*[gcd(i,j)=1]}
\\&=\prod_{d=1}^{min(n,m)}{d^{d*\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}\sum_{j=1}^{\lfloor\frac{m}{d}\rfloor}i*j*[gcd(i,j)=1]}}\prod_{i=1}^{\lfloor\frac{n}{d}\rfloor}\prod_{j=1}^{\lfloor\frac{m}{d}\rfloor}\Big(i*j\Big)^{d*i*j*[gcd(i,j)=1]}
\\记&f_1(n)=\sum_{i=1}^n{i},
\\&f_2(n)=\prod_{i=1}^n{i^i},
\\&S(n,m)=\sum_{i=1}^n\sum_{j=1}^m{i*j*[gcd(i,j)=1]},
\\&G(n,m)=\prod_{i=1}^{n}\prod_{j=1}^m{(i*j)^{i*j*[gcd(i,j)=1]}},
\\&则:
\\上式&=\prod_{d=1}^{min(n,m)}{d^{d*S(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor)}*\Big[G(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor)\Big]^d}
\\S(n,m)&=\sum_{i=1}^n\sum_{j=1}^m{i*j*[gcd(i,j)=1]}
\\&=\sum_{i=1}^n\sum_{j=1}^m{i*j*\sum_{d|gcd(i,j)}{\mu(d)}}
\\&=\sum_{d|min(n,m)}\sum_{d|i}^n\sum_{d|j}^m{\mu(d)*d^2*\frac{i}{d}*\frac{j}{d}}
\\&=\sum_{d=1}^{min(n,m)}{\mu(d)*d^2}\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}{i}\sum_{j=1}^{\lfloor\frac{m}{d}\rfloor}{j}
\\&=\sum_{d=1}^{min(n,m)}{\mu(d)*d^2}*f(\lfloor\frac{n}{d}\rfloor)*f(\lfloor\frac{m}{d}\rfloor)
\\&=\sum_{l=1,r=\lfloor\frac{min(n,m)}{\lfloor\frac{min(n,m)}{l}\rfloor}\rfloor}^{l\leq min(n,m)}{f(\lfloor\frac{n}{d}\rfloor)*f(\lfloor\frac{m}{d}\rfloor)*\Big(\sum_{i=l}^r{\mu(d)*d^2}\Big)} --数论数块
\\&显然上式可以预处理\sum_{i=1}^n{\mu(d)*d^2},然后数论分块
\\G(n,m)&=\prod_{i=1}^{n}\prod_{j=1}^m{(i*j)^{i*j*[gcd(i,j)=1]}}
\\&=\prod_{i=1}^n\prod_{j=1}^m{(i*j)^{i*j*\sum_{d|gcd(i,j)}{\mu(d)}}}
\\&=\prod_{d=1}^{min(n,m)}\prod_{d|i}^n\prod_{j|d}^m{(d^2*\frac{i}{d}*\frac{j}{d})^{\mu(d)*d^2*\frac{i}{d}*\frac{j}{d}}}
\\&=\prod_{d=1}^{min(n,m)}\prod_{i=1}^{\lfloor\frac{n}{d}\rfloor}\prod_{j=1}^{\lfloor\frac{m}{d}\rfloor}{(d^2*i*j)^{\mu(d)*d^2*i*j}}
\\&=\prod_{d=1}^{min(n,m)}{(d^2)^{\mu(d)*d^2*\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}{i}\sum_{j=1}^{\lfloor\frac{m}{d}\rfloor}{j}}}*\prod_{i=1}^{\lfloor\frac{n}{d}\rfloor}\prod_{j=1}^{\lfloor\frac{m}{d}\rfloor}{(i*j)^{\mu(d)*d^2*i*j}}
\\&=\prod_{d=1}^{min(n,m)}{(d^2)^{\mu(d)*d^2*f_1(\lfloor\frac{n}{d}\rfloor)*f_1(\lfloor\frac{m}{d}\rfloor)}}*\Big[\big(\prod_{i=1}^{\lfloor\frac{n}{d}\rfloor}{i^i}\big)^{\sum_{j=1}^{\lfloor\frac{m}{d}\rfloor}{j}}*\big(\prod_{j=1}^{\lfloor\frac{m}{d}\rfloor}{j^j}\big)^{\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}{i}}\Big]^{\mu(d)*d^2}
\\&=\prod_{d=1}^{min(n,m)}{\Big[(d^2)^{\mu(d)*d^2}\Big]^{f_1(\lfloor\frac{n}{d}\rfloor)*f_1(\lfloor\frac{m}{d}\rfloor)}}*\Big[f_2(\lfloor\frac{n}{d}\rfloor)^{f_1(\lfloor\frac{m}{d}\rfloor)}*f_2(\lfloor\frac{m}{d}\rfloor)^{f_1(\lfloor\frac{n}{d}\rfloor)}\Big]^{\mu(d)*d^2}


\\\end{align}
$$

