# 错排

## 定义

$$
\\ 给定一个n的排列,求每个位置上的数不在当前位置上的排列有多少种
$$

## 定理

$$
\\ 排列n的错排通式:D_n = n!(\sum_{i=0}^n(-1)^i\frac{1}{i!})
\\ 递推式1:D_n = (n-1)(D_{n-1}+D_{n-2}), D_1=0,D_2=1
\\ 递推式2:D_n = nD_{n-1}+(-1)^n
$$

## 证明

### 组合数学证明(dp)

$$
\\ 一个n的排列,考虑它的错排.
\\ 当考虑到第n个元素时,它可以与前n-1个元素的错排D_{n-1}中的元素交换转移到D_n
\\ 这样的转移有C_{n-1}^1D_{n-1}=(n-1)D_{n-1}种
\\ 考虑从前n-1个元素的非错排转移过来
\\ 不妨考虑前n-1个元素里只有一个元素没被错排,则第n个元素与其交换,有(n-1)D_{n-2}种
\\ 若前n-1个元素里有2个元素没被错排,那么第n个元素与任一进行交换之后变成第一种D_{n-1}的情况
\\ 通过归纳不难知道只需要考虑D_{n-1}, D_{n-2}
\\
\begin{align}
\\ 故: D_n &= (n-1)(D_{n-1}+D_{n-2})
\\ D_n-nD_{n-1}&=(n-1)(D_{n-1}+D_{n-2})-nD_{n-1}
\\ D_n-nD_{n-1}&=-(D_{n-1}-(n-1)D_{n-2})
\\ T_n&=-T_{n-1}, 令T_n=D_n-nD_{n-1},则:T_n=(-1)^nT_1
\end{align}
$$

### 容斥

$$
\\ D_n=总的排列-不符合错排的排列
\\ 定义P_i表示第i个数不符合错排的排列,则P_i=(n-1)!
\\ D_n=n!-|\cup_{i=1}^nP_i|
\\ 容斥定理:|\cup_{i=1}^nP_i|=\sum_{i=1}^n|P_i|-\sum_{1\leq i<j\leq n}|P_i\cap P_j| + \sum_{1\leq i<j<k\leq n}|P_i\cap P_j \cap P_k| \dots
\\ \sum_{i=1}^n|P_i|=C_n^1A_{n-1}^{n-1}, \sum_{1\leq i<j\leq n}|P_i\cap P_j|=C_n^2A_{n-2}^{n-2},\sum_{1\leq i<j<k\leq n}|P_i\cap P_j \cap P_k|=C_n^3A_{n-3}^{n-3}
\\ |\cup_{i=1}^nP_i|=\sum_{i=1}^n(-1)^{i-1}C_n^iA_{n-i}^{n-i}=\sum_{i=1}^n(-1)^{n-1}\frac{n!}{i!}
\\ D_n=n!+\sum_{i=1}^n(-1)^n\frac{n!}{i!}
$$



### 生成函数

